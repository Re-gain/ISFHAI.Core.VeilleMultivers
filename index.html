<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galaxie Veille Technologique</title>
  <link rel="icon" href="data:,">
  <style>
    :root {
      --color-bg: #0b0f1a;
      --color-fg: #aef;
      --color-light: #3fdad8;
      --font-main: 'Orbitron', sans-serif;
    }
    body {
      margin: 0;
      overflow: hidden;
      background-color: var(--color-bg);
      font-family: var(--font-main);
    }
    canvas {
      display: block;
    }
    #info {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--color-fg);
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      text-shadow: 0 0 10px #6366f1;
      z-index: 1000;
    }
    .label {
      position: absolute;
      color: var(--color-light);
      font-size: clamp(0.6rem, 1vw, 1rem);
      text-shadow: 1px 1px 2px #000;
      transform: perspective(500px) rotateX(10deg);
      pointer-events: none;
      white-space: nowrap;
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 30, 0.95);
      border: 1px solid var(--color-light);
      padding: 2rem;
      border-radius: 10px;
      color: #fff;
      z-index: 9999;
      display: none;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal.active {
      display: block;
    }
    #toggleTheme {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: transparent;
      border: 1px solid var(--color-light);
      color: var(--color-light);
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
    }
    @media (max-width: 768px) {
      #info {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="info">ðŸŒž Technologie â€“ SystÃ¨me Solaire de Veille</div>
  <button id="toggleTheme">ðŸŒ’</button>
  <div id="labels"></div>
  <div id="modal" class="modal"></div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.150.1/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.150.1/examples/jsm/controls/OrbitControls.js';

    const isMobile = /Mobi|Android/i.test(navigator.userAgent);
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.rotateSpeed = 0.3;

    const sun = new THREE.Mesh(
      new THREE.SphereGeometry(1.2, 64, 64),
      new THREE.MeshBasicMaterial({ color: 0xffcc00 })
    );
    scene.add(sun);

    const planetMaterial = new THREE.MeshStandardMaterial({ color: 0x3fdad8 });
    const light = new THREE.PointLight(0xffffff, 1.2);
    light.position.set(5, 5, 5);
    scene.add(light);

    const labels = document.getElementById('labels');
    const modal = document.getElementById('modal');
    const data = {
      "galaxie": "Veille Technologique Cosmique",
      "systemes": [
        {
          "theme": "Technologie",
          "soleil": "ðŸŒž Technologie & Innovation",
          "planetes": [
            { "nom": "IA GÃ©nÃ©rative", "fiche": "fiche_ia_gen.html" },
            { "nom": "Edge AI & IoT", "fiche": "fiche_edge.html" },
            { "nom": "Cyber-IA", "fiche": "fiche_cyber.html" },
            { "nom": "Collaboration Homme-Machine", "fiche": "fiche_collab.html" },
            { "nom": "IA Ã‰thique", "fiche": "fiche_ethique.html" },
            { "nom": "IA Explicable", "fiche": "fiche_explicable.html" }
          ]
        }
      ]
    };

    const planets = [];
    const system = data.systemes[0];

    system.planetes.forEach((entry, i) => {
      const geo = new THREE.SphereGeometry(0.3, 32, 32);
      const planet = new THREE.Mesh(geo, planetMaterial.clone());
      const orbitRadius = 2.5 + i * 0.9;
      planet.userData = {
        angle: Math.random() * Math.PI * 2,
        radius: orbitRadius,
        label: entry.nom,
        fiche: entry.fiche
      };
      planet.scale.set(0, 0, 0);
      scene.add(planet);
      planets.push(planet);

      const label = document.createElement('div');
      label.className = 'label';
      label.innerText = entry.nom;
      labels.appendChild(label);
      planet.userData.labelElement = label;
    });

    camera.position.z = isMobile ? 10 : 7;
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();

    window.addEventListener('click', (event) => {
      mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(planets);
      if (intersects.length > 0) {
        const planet = intersects[0].object;
        modal.innerHTML = `<h2>${planet.userData.label}</h2><p>Chargement dynamique depuis: ${planet.userData.fiche}</p>`;
        modal.classList.add('active');
      }
    });

    document.getElementById('toggleTheme').addEventListener('click', () => {
      const root = document.documentElement;
      if (root.style.getPropertyValue('--color-bg') === '#0b0f1a') {
        root.style.setProperty('--color-bg', '#f4f4f4');
        root.style.setProperty('--color-fg', '#111');
      } else {
        root.style.setProperty('--color-bg', '#0b0f1a');
        root.style.setProperty('--color-fg', '#aef');
      }
      document.body.style.backgroundColor = root.style.getPropertyValue('--color-bg');
    });

    function animate() {
      requestAnimationFrame(animate);
      planets.forEach((planet, idx) => {
        if (planet.scale.x < 1) {
          const s = planet.scale.x + 0.02;
          planet.scale.set(s, s, s);
        }
        planet.userData.angle += 0.002 + idx * 0.0003;
        planet.position.x = Math.cos(planet.userData.angle) * planet.userData.radius;
        planet.position.z = Math.sin(planet.userData.angle) * planet.userData.radius;

        const vector = planet.position.clone().project(camera);
        const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
        const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
        if (planet.userData.labelElement) {
          planet.userData.labelElement.style.left = `${x}px`;
          planet.userData.labelElement.style.top = `${y}px`;
        }
      });
      controls.update();
      renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
  </script>
</body>
</html>
